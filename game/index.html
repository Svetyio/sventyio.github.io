<!DOCTYPE html>
      }

      function spin() {
        if (spinning || coins < selectedBet) return;
        spinning = true;
        coins -= selectedBet;
        grid = generateGrid();
        const win = checkWin();
        lastWin = win;
        totalWin += win;
        if (win > 0) coins += win;
        drawGrid();
        if (win > 0) {
          winLabel.textContent = `ПЕЧАЛБА +${win}`;
          winLabel.classList.add("active");
          setTimeout(() => winLabel.classList.remove("active"), 1500);
        }
        spinning = false;
      }

      function checkWin() {
        let win = 0;
        for (let r = 0; r < GRID_SIZE; r++) {
          if (grid[r].every(f => f === grid[r][0])) win += FRUIT_VALUES[grid[r][0]] * 5;
        }
        for (let c = 0; c < GRID_SIZE; c++) {
          let colF = [];
          for (let r = 0; r < GRID_SIZE; r++) colF.push(grid[r][c]);
          if (colF.every(f => f === colF[0])) win += FRUIT_VALUES[colF[0]] * 5;
        }
        let d1 = [], d2 = [];
        for (let i = 0; i < GRID_SIZE; i++) {
          d1.push(grid[i][i]);
          d2.push(grid[i][GRID_SIZE - 1 - i]);
        }
        if (d1.every(f => f === d1[0])) win += FRUIT_VALUES[d1[0]] * 5;
        if (d2.every(f => f === d2[0])) win += FRUIT_VALUES[d2[0]] * 5;
        return win;
      }

      function restartGame() {
        coins = 500;
        lastWin = 0;
        totalWin = 0;
        grid = generateGrid();
        drawGrid();
      }

      spinBtn.addEventListener('click', spin);
      restartBtn.addEventListener('click', restartGame);
      document.querySelectorAll('#bets .btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const val = parseInt(btn.innerText);
          if (!isNaN(val)) setBet(val);
        });
      });

      grid = generateGrid();
      setBet(selectedBet);
      resizeCanvas();
      drawGrid();
      window.addEventListener("load", () => {
        resizeCanvas();
        drawGrid();
      });
    })();
  </script>
</body>
</html>
