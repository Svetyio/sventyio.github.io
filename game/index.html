<!DOCTYPE html>
            }
        },1500);
    }
    function stopSpinHold(e){
        pointerIsDown=false;
        if(spinHoldTimeout){clearTimeout(spinHoldTimeout);spinHoldTimeout=null;}
    }
    function doAutoSpin(){
        if(!autoSpin){spinBtn.classList.remove('auto');return;}
        if(coins<selectedBet){stopAutoSpin();return;}
        if(!spinning)spin(true);
        let nextSpin=1800+Math.random()*1000;
        autoSpinTimer=setTimeout(doAutoSpin,nextSpin);
    }
    function stopAutoSpin(){
        autoSpin=false;
        spinBtn.classList.remove('auto');
        if(autoSpinTimer){clearTimeout(autoSpinTimer);autoSpinTimer=null;}
    }

    spinBtn.addEventListener('mousedown',startSpinHold);
    spinBtn.addEventListener('touchstart',startSpinHold);
    spinBtn.addEventListener('mouseup',function(e){
        stopSpinHold();
        if(autoSpin)return stopAutoSpin();
        let held=Date.now()-pointerDownTime;
        if(held<1500&&!spinning)spin();
    });
    spinBtn.addEventListener('mouseleave',stopSpinHold);
    spinBtn.addEventListener('touchend',function(e){
        stopSpinHold();
        if(autoSpin)return stopAutoSpin();
        let held=Date.now()-pointerDownTime;
        if(held<1500&&!spinning)spin();
    });
    spinBtn.addEventListener('click',function(e){
        if(autoSpin){stopAutoSpin();}
        stopWinEffect();
    });

    restartBtn.addEventListener('click',restartGame);
    document.querySelectorAll('#bets .btn').forEach(btn=>{
        btn.addEventListener('click',()=>{
            const val=Number(btn.innerText);
            window.setBet(val);
        });
    });

    // Начален екран
    document.getElementById('startBtn').onclick=function(){
        startScreen.style.display='none';
        resizeCanvas();
        drawGrid();
        updateStats();
    };

    // Инициализация
    grid=generateGrid();
    loadProgress();
    window.setBet(selectedBet);
    resizeCanvas();
    drawGrid();
    updateStats();
    </script>
</body>
</html>
