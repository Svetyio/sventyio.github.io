<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Svetlyo Slot Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
<style>
html,body{margin:0;padding:0;min-height:100vh;
    background:linear-gradient(135deg,#ffe066 0%,#ffd700 30%,#b94ce7 100%);
}
body{color:#fff;font-family:'Segoe UI',Arial,sans-serif;text-align:center;user-select:none;}
#container{position:relative;width:100vw;max-width:440px;margin:0 auto;}
.small-title{font-size:27px;font-weight:700;margin:22px auto 0 auto;letter-spacing:2px;max-width:99vw;text-shadow:0 2px 14px #8e44ad, 0 0 4px #FFD700;}
#gameCanvas{display:block;margin:18px auto 5px auto;background:#fffbe7;
    border:8px solid #ffd700;border-radius:28px;
    box-shadow:0 0 38px 8px #ffd70077,0 0 24px #b94ce7cc;
    max-width:96vw;width:96vw;height:96vw;min-width:240px;min-height:240px;max-height:400px;touch-action:none;}
#winLabel{
    position:absolute;left:50%;transform:translateX(-50%);top:15px;
    font-size:33px;font-weight:900;
    background:linear-gradient(90deg,#ffd700,#ff69b4,#ffd700,#fff176,#ffd700);
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 28px #ffd700,0 2px 17px #fff;
    padding:10px 34px;border-radius:38px;opacity:0;pointer-events:none;z-index:100;
    transition:opacity 0.6s;white-space:nowrap;animation:shineText 2.5s linear infinite;
}
@keyframes shineText{
    0%{background-position:0 50%;}
    100%{background-position:100% 50%;}
}
#winLabel.active{opacity:1!important;pointer-events:auto;transition:none;}
#loseLabel{display:none;position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(20,20,20,0.65);color:#FFD700;font-size:2.3em;font-weight:bold;align-items:center;justify-content:center;z-index:400;flex-direction:column;}
#loseLabel.show{display:flex;}
#loseLabel button {
    margin-top: 32px;
    background: #1e90ff;
    color: #fff;
    border: none;border-radius: 17px;font-size: 1.1em;font-weight: bold;
    padding: 16px 42px;
    box-shadow: 0 0 14px #1e90ff99;
    cursor: pointer;transition: background 0.3s, transform 0.2s;
}
#loseLabel button:hover,
#loseLabel button:focus-visible {background: #00ccff;transform: scale(1.07);}
#noCoinsMsg {display:none;color:#FFD700;font-weight:bold;margin-top:10px;font-size:1.25em;}
#info-row{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:14px;margin:10px auto 10px auto;width:100%;max-width:600px;flex-wrap:wrap;}
.info-box{background:#fffbe7;border:2px solid #ffd700;border-radius:13px;font-size:18px;min-width:90px;min-height:38px;padding:8px 18px;color:#b94ce7;display:flex;align-items:center;justify-content:center;font-weight:600;box-shadow:0 0 10px 2px #ffd70042;}
#coins{background-color:#fffbe7;}
#lastWin{background-color:#fffbe7;}
#totalWin{background-color:#fffbe7;}
#currentBet{background-color:#fffbe7;min-width:70px;}
#autoSpinIndicator{background:rgba(255,223,0,0.21);color:#FFD700;font-weight:bold;display:none;padding:3px 10px;border-radius:12px;margin:5px auto 0 auto;font-size:1.1em;animation:autosign 1.1s infinite alternate;}
@keyframes autosign{0%{box-shadow:0 0 0 #FFD700;}100%{box-shadow:0 0 12px #FFD700;}}
#bets{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:10px;margin:10px auto 0 auto;width:100%;max-width:600px;flex-wrap:wrap;}
.btn{padding:10px 18px;font-size:18px;color:#fff;background-color:#b94ce7;border:none;border-radius:13px;cursor:pointer;min-width:54px;min-height:38px;outline:none;box-shadow:0 1px 14px #ffd70099;font-weight:600;letter-spacing:1px;transition:background 0.2s,color 0.2s,transform 0.15s,box-shadow 0.2s;user-select:none;}
.btn.selected-bet,.btn:active.selected-bet{background-color:#ffd700!important;color:#b94ce7!important;box-shadow:0 0 14px 2px #ffd700;font-weight:bold;animation:betpulse 0.31s;}
@keyframes betpulse {0%{box-shadow:0 0 0 #FFD700;}50%{box-shadow:0 0 18px #FFD700,0 0 10px #fff;}100%{box-shadow:0 0 0 #00cc00;}}
.btn:focus-visible:not(.selected-bet){background-color:#fffbe7;color:#b94ce7;}
.btn:disabled{background:#eee!important;color:#888!important;cursor:not-allowed;box-shadow:none;}
#spinBtn{
    background:linear-gradient(145deg,#ffd700 40%,#b94ce7 90%);
    border-radius:50%;width:104px;height:104px;font-size:2.1em;font-weight:bold;
    color:#b94ce7;margin:28px auto 12px auto;display:block;transition:background 0.3s,transform 0.7s;box-shadow:0 0 36px #ffd700,0 0 48px #fff0;border:none;outline:none;
    animation:pulseSpinBtn 1.5s infinite alternate;
    position:relative;overflow:hidden;
    display:flex;align-items:center;justify-content:center;
}
#spinBtn span{
    display:inline-block;font-size:1.05em;line-height:1.15;letter-spacing:2px;vertical-align:middle;
}
@keyframes pulseSpinBtn{0%{box-shadow:0 0 28px #ffd700,0 0 10px #fff0;}100%{box-shadow:0 0 44px #FFD700,0 0 44px #fff4;transform:scale(1.10);}}
#spinBtn:hover,#spinBtn:focus-visible{background:linear-gradient(145deg,#fff176,#b94ce7 90%);transform:rotate(-8deg) scale(1.13);}
#spinBtn.auto{background:linear-gradient(145deg,#00cc00,#26df26 90%)!important;box-shadow:0 0 36px #00cc00,0 0 48px #fff;animation:none!important;transform:scale(1.10);}
#spinTooltip {display:none;position:absolute;left:50%;top:-40px;transform:translateX(-50%);background:rgba(20,20,20,0.93);color:#FFD700;font-size:1.06em;font-weight:700;border-radius:10px;padding:7px 16px;white-space:nowrap;z-index:3000;pointer-events:none;box-shadow:0 0 12px #FFD70055;}
#confetti{pointer-events:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1200;display:none;}
@media (max-width:600px){#container{max-width:98vw;}#gameCanvas{max-width:98vw;max-height:240px;}#winLabel{font-size:16px;padding:4px 10px;}.small-title{font-size:17px;}.info-box{font-size:12px;min-width:38px;min-height:13px;padding:3px 7px;}#bets{gap:3px;}.btn{font-size:13px;min-height:24px;padding:6px 10px;}#spinBtn{width:60px;height:60px;font-size:1.1em;}}
.coin-fall{position:absolute;left:50%;top:-40px;font-size:2em;pointer-events:none;animation:coin-fall-anim 0.9s cubic-bezier(.42,.25,.58,.94) forwards;}
@keyframes coin-fall-anim{0%{top:-40px;opacity:0.7;transform:scale(0.9);}80%{opacity:1;transform:scale(1.15);}100%{top:80%;opacity:0;transform:scale(1.07);}}
</style>
</head>
<body>
<div class="small-title">Svetlyo Games</div>
<div id="container">
    <span id="winLabel"></span>
    <span id="loseLabel">
        –°–≤—ä—Ä—à–∏—Ö–∞ —Ç–∏ –ø–∞—Ä–∏—Ç–µ!<br>–ù–∞—Ç–∏—Å–Ω–∏ <button id="restartBtn" tabindex="7">–ù–æ–≤–∞ –∏–≥—Ä–∞</button>
    </span>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div id="coinContainer" style="position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;"></div>
</div>
<div id="confetti"></div>
<div id="noCoinsMsg">–ù—è–º–∞—à –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –º–æ–Ω–µ—Ç–∏!</div>
<div id="autoSpinIndicator">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω —Ä–µ–∂–∏–º</div>
<div id="info-row">
    <div class="info-box" id="coins">–ú–æ–Ω–µ—Ç–∏: 500</div>
    <div class="info-box" id="lastWin">–ü–æ—Å–ª–µ–¥–Ω–∞ –ø–µ—á–∞–ª–±–∞: 0</div>
    <div class="info-box" id="totalWin">–û–±—â–∞ –ø–µ—á–∞–ª–±–∞: 0</div>
    <div class="info-box" id="currentBet">–ó–∞–ª–æ–≥: 20</div>
</div>
<div id="bets">
    <button class="btn" tabindex="1" id="betBtn20">20</button>
    <button class="btn" tabindex="2" id="betBtn40">40</button>
    <button class="btn" tabindex="3" id="betBtn60">60</button>
    <button class="btn" tabindex="4" id="betBtn100">100</button>
    <button class="btn" tabindex="5" id="betBtn200">200</button>
</div>
<div style="position:relative;">
    <button id="spinBtn" tabindex="6"><span>–°–ü–ò–ù</span></button>
    <div id="spinTooltip">–ó–∞–¥—Ä—ä–∂ –∑–∞ –∞–≤—Ç–æ-—Å–ø–∏–Ω</div>
</div>
<audio id="audio-spin" src="https://cdn.pixabay.com/audio/2022/08/20/audio_128bfa0b4c.mp3" preload="auto"></audio>
<audio id="audio-win" src="https://cdn.pixabay.com/audio/2023/02/24/audio_126bdb7e5c.mp3" preload="auto"></audio>
<audio id="audio-lose" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124b8d6929.mp3" preload="auto"></audio>
<audio id="audio-music" src="https://cdn.pixabay.com/audio/2022/08/20/audio_128c6fcd23.mp3" preload="auto" loop></audio>
<script>
const FRUITS = [
    {char:'üçí', name:'–ß–µ—Ä–µ—à–∞',   points:20,  color:"#ff5bcd"},
    {char:'üçâ', name:'–î–∏–Ω—è',     points:40,  color:"#42e1fe"},
    {char:'üçá', name:'–ì—Ä–æ–∑–¥–µ',   points:60,  color:"#a87fff"},
    {char:'üçé', name:'–Ø–±—ä–ª–∫–∞',   points:80,  color:"#ff4040"},
    {char:'üçÄ', name:'–î–µ—Ç–µ–ª–∏–Ω–∞', points:100, color:"#00e676"}
];
const FRUIT_CHARS = FRUITS.map(f=>f.char);
const FRUIT_POINTS = {}; FRUITS.forEach(f=>FRUIT_POINTS[f.char]=f.points);
const FRUIT_PROBS = [0.28, 0.25, 0.20, 0.16, 0.11];
const ACCUM_PROBS = FRUIT_PROBS.reduce((acc, p, i) => (acc[i] = (acc[i-1]||0)+p, acc), []);
let selectedBet=20, coins=500, lastWin=0, totalWin=0, grid=[];
let spinning=false, autoSpin=false, autoSpinTimer=null, spinHoldTimeout=null;
let pointerDownTime=0, pointerIsDown=false;
let winLines=[], winEffectActive=false, winEffectFrame=0, winAnimFrameId=null;
let loseEffectActive=false, loseEffectFrame=0, loseAnimFrameId=null;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');
const restartBtn = document.getElementById('restartBtn');
const winLabel = document.getElementById('winLabel');
const loseLabel = document.getElementById('loseLabel');
const currentBetBox = document.getElementById('currentBet');
const coinContainer = document.getElementById('coinContainer');
const paytableBet = 20;
const betBtns = [
    document.getElementById('betBtn20'),
    document.getElementById('betBtn40'),
    document.getElementById('betBtn60'),
    document.getElementById('betBtn100'),
    document.getElementById('betBtn200')
];
const autoSpinIndicator = document.getElementById('autoSpinIndicator');
const noCoinsMsg = document.getElementById('noCoinsMsg');
const spinTooltip = document.getElementById('spinTooltip');
const confettiDiv = document.getElementById('confetti');
const VALID_BETS = [20,40,60,100,200];
const GRID_SIZE = 5;
const audioSpin = document.getElementById('audio-spin');
const audioWin = document.getElementById('audio-win');
const audioLose = document.getElementById('audio-lose');
const audioMusic = document.getElementById('audio-music');
audioMusic.volume = 0.22;

// -------------------------------------
// –ê—É–¥–∏–æ —Ñ–æ–Ω
let musicStarted = false;
function playMusic() {
    if (!musicStarted) {
        audioMusic.play().catch(()=>{});
        musicStarted = true;
    }
}
document.addEventListener('click',playMusic,{once:true});
document.addEventListener('touchstart',playMusic,{once:true});
document.addEventListener('visibilitychange',()=>{
    if (!document.hidden) playMusic();
});

// -------------------------------------
// –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–µ –∏ Responsive
function resizeCanvas() {
    let s=Math.min(window.innerWidth*0.96,400,window.innerHeight*0.65);
    s=Math.max(s,240);
    canvas.width=s;
    canvas.height=s;
    drawGrid();
}
window.addEventListener("resize",resizeCanvas);

// -------------------------------------
// –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–∏ —Å–∏–º–≤–æ–ª–∏, box-shadow –∏ outline
function drawGrid(animSpin) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const c=canvas.width/(GRID_SIZE+.16),m=c*.13;
    const o=(canvas.width-(GRID_SIZE*c+(GRID_SIZE-1)*m))/2;
    const y=(canvas.height-(GRID_SIZE*c+(GRID_SIZE-1)*m))/2;
    for(let r=0;r<GRID_SIZE;r++) for(let col=0;col<GRID_SIZE;col++){
        const x=o+col*(c+m), y0=y+r*(c+m);
        ctx.save();
        ctx.fillStyle='#fffbe7';
        ctx.globalAlpha=.99;
        ctx.fillRect(x,y0,c,c);
        ctx.strokeStyle='#ffd700'; ctx.lineWidth=3;
        ctx.shadowColor='#ffd700'; ctx.shadowBlur=18;
        ctx.strokeRect(x+2,y0+2,c-4,c-4);
        ctx.restore();

        ctx.save();
        ctx.font=`bold ${Math.floor(c*.58)}px 'Luckiest Guy',cursive,serif`;
        ctx.textAlign='center';
        ctx.textBaseline='middle';
        let fruit=grid[r][col];
        ctx.shadowColor='#b94ce7';
        ctx.shadowBlur=0;
        ctx.globalAlpha=1;
        ctx.fillText(fruit,x+c/2,y0+c/2+2);
        ctx.restore();
    }
    // win –∞–Ω–∏–º–∞—Ü–∏—è: –∫–æ–Ω—Ñ–µ—Ç–∏ –∏–ª–∏ –º–æ–Ω–µ—Ç–∏
    if (winEffectActive) showConfetti();
}

function randomFruit() {
    let r = Math.random();
    for (let i = 0; i < ACCUM_PROBS.length; i++) {
        if (r < ACCUM_PROBS[i]) return FRUITS[i].char;
    }
    return FRUITS[FRUITS.length-1].char;
}

// –ò—Å—Ç–∏–Ω—Å–∫–∏ spin-–∞–Ω–∏–º–∞—Ü–∏—è
function animateSpin(newGrid,cb) {
    let animFrames = 20;
    let spinRows = [];
    for(let c=0;c<GRID_SIZE;c++){
        let arr=[];for(let i=0;i<animFrames;i++)arr.push(randomFruit());
        spinRows.push(arr);
    }
    let frame=0;
    function spinStep() {
        for(let col=0;col<GRID_SIZE;col++){
            for(let row=0;row<GRID_SIZE;row++){
                if(frame<animFrames)
                    grid[row][col]=spinRows[col][(frame+row)%animFrames];
                else
                    grid[row][col]=newGrid[row][col];
            }
        }
        drawGrid();
        if(frame<animFrames) {
            frame++;
            setTimeout(spinStep,42+col*2);
        } else {
            cb&&cb();
        }
    }
    spinStep();
}

function setBet(bet){
    bet=Number(bet);
    if(!VALID_BETS.includes(bet))return;
    selectedBet=bet;
    betBtns.forEach(btn => {
        const val = Number(btn.innerText);
        btn.classList.toggle('selected-bet', val === bet);
        if(val === bet) { btn.style.animation="betpulse 0.31s"; setTimeout(()=>btn.style.animation="",350);}
    });
    updateInfo();
    if (coins < selectedBet && autoSpin) stopAutoSpin();
}

function updateInfo() {
    document.getElementById('coins').innerText=`–ú–æ–Ω–µ—Ç–∏: ${coins}`;
    document.getElementById('lastWin').innerText=`–ü–æ—Å–ª–µ–¥–Ω–∞ –ø–µ—á–∞–ª–±–∞: ${lastWin}`;
    document.getElementById('totalWin').innerText=`–û–±—â–∞ –ø–µ—á–∞–ª–±–∞: ${totalWin}`;
    currentBetBox.innerText=`–ó–∞–ª–æ–≥: ${selectedBet}`;
    spinBtn.style.display=coins>0?'flex':'none';
    noCoinsMsg.style.display = coins <= 0 ? 'block' : 'none';
    showLose(coins===0);
    for(let i=0;i<betBtns.length;++i){
        betBtns[i].disabled = (coins <= 0);
    }
    if(autoSpin) autoSpinIndicator.style.display="inline-block";
    else autoSpinIndicator.style.display="none";
}

function showLose(show) {
    loseLabel.classList.toggle("show",!!show);
}

function showConfetti() {
    confettiDiv.style.display='block';
    confettiDiv.innerHTML='';
    for(let i=0;i<32;i++){
        let d=document.createElement('div');
        d.style.position='absolute';
        d.style.left=(2+Math.random()*96)+'vw';
        d.style.top=(2+Math.random()*40)+'vh';
        d.style.fontSize=(2+Math.random()*3)+'em';
        d.style.color=['#ffd700','#fff176','#b94ce7','#ff69b4','#fff'][i%5];
        d.innerText='ü™ô';
        d.style.transform=`rotate(${Math.random()*360}deg)`;
        confettiDiv.appendChild(d);
    }
    setTimeout(()=>{confettiDiv.style.display='none';},1700);
}

function spin(isAuto){
    if (spinning) return;
    spinning=true;
    winLabel.classList.remove('active');
    audioSpin.currentTime=0;audioSpin.play();
    coins-=selectedBet;
    if (coins < 0) coins = 0;
    if (coins < selectedBet && autoSpin) stopAutoSpin();
    let newGrid=generateGrid();
    animateSpin(newGrid,()=>{
        let {win,lines}=calcWins();
        win = Number(win.toFixed(0));
        lastWin=win;
        totalWin+=win;
        if(win>0){
            coins+=win;
            winLines=lines;
            winEffectActive=true;
            winLabel.textContent=`–ü–ï–ß–ê–õ–ë–ê +${win}`;
            winLabel.classList.add("active");
            if(win >= selectedBet * 5){
                audioWin.currentTime=0;audioWin.play();
                showConfetti();
            } else {
                audioWin.currentTime=0;audioWin.play();
            }
        } else {
            audioLose.currentTime=0;audioLose.play();
        }
        setTimeout(()=>{winLabel.classList.remove("active");winEffectActive=false;confettiDiv.style.display='none';},1700);
        spinning=false;
        updateInfo();
        if(autoSpin&&coins<selectedBet)stopAutoSpin();
        if(autoSpin&&!isAuto)doAutoSpin();
        drawGrid();
    });
}

function generateGrid() {
    let arr=[];
    for(let r=0;r<GRID_SIZE;r++){
        let row=[];
        for(let c=0;c<GRID_SIZE;c++) row.push(randomFruit());
        arr.push(row);
    }
    if(Math.random()<0.40) generateWinningRow(arr);
    if(Math.random()<0.25) generateWinningCol(arr);
    if(Math.random()<0.15) generateWinningDiag(arr);
    if(Math.random()<0.12) generateWinningDiag2(arr);
    return arr;
}
function generateWinningRow(arr) {
    let winRow=Math.floor(Math.random()*GRID_SIZE);
    let winFruit=FRUIT_CHARS[Math.floor(Math.random()*FRUIT_CHARS.length)];
    for(let c=0;c<GRID_SIZE;c++)arr[winRow][c]=winFruit;
}
function generateWinningCol(arr) {
    let winCol=Math.floor(Math.random()*GRID_SIZE);
    let winFruit=FRUIT_CHARS[Math.floor(Math.random()*FRUIT_CHARS.length)];
    for(let r=0;r<GRID_SIZE;r++)arr[r][winCol]=winFruit;
}
function generateWinningDiag(arr) {
    let winFruit=FRUIT_CHARS[Math.floor(Math.random()*FRUIT_CHARS.length)];
    for(let i=0;i<GRID_SIZE;i++)arr[i][i]=winFruit;
}
function generateWinningDiag2(arr) {
    let winFruit=FRUIT_CHARS[Math.floor(Math.random()*FRUIT_CHARS.length)];
    for(let i=0;i<GRID_SIZE;i++)arr[i][GRID_SIZE-1-i]=winFruit;
}
function calcWins() {
    let win=0,lines=[];
    for(let r=0;r<GRID_SIZE;r++){
        let f=grid[r][0];
        if(grid[r].every(ff=>ff===f)){
            let points=FRUIT_POINTS[f]*selectedBet/20;
            win+=points;
            lines.push({type:"row",coords:Array.from({length:GRID_SIZE},(_,i)=>[r,i]),fruit:f});
        }
    }
    for(let c=0;c<GRID_SIZE;c++){
        let f=grid[0][c],all=true;
        for(let r=0;r<GRID_SIZE;r++)if(grid[r][c]!==f)all=false;
        if(all){
            let points=FRUIT_POINTS[f]*selectedBet/20;
            win+=points;
            lines.push({type:"col",coords:Array.from({length:GRID_SIZE},(_,i)=>[i,c]),fruit:f});
        }
    }
    let f1=grid[0][0],all1=true;
    for(let i=0;i<GRID_SIZE;i++) if(grid[i][i]!==f1) all1=false;
    if(all1){
        let points=FRUIT_POINTS[f1]*selectedBet/20;
        win+=points;
        lines.push({type:"diag",coords:Array.from({length:GRID_SIZE},(_,i)=>[i,i]),fruit:f1});
    }
    let f2=grid[0][GRID_SIZE-1],all2=true;
    for(let i=0;i<GRID_SIZE;i++) if(grid[i][GRID_SIZE-1-i]!==f2) all2=false;
    if(all2){
        let points=FRUIT_POINTS[f2]*selectedBet/20;
        win+=points;
        lines.push({type:"diag2",coords:Array.from({length:GRID_SIZE},(_,i)=>[i,GRID_SIZE-1-i]),fruit:f2});
    }
    win = Number(win.toFixed(0));
    return {win,lines};
}

function restartGame(){
    coins=500;lastWin=0;totalWin=0;grid=generateGrid();
    showLose(false);drawGrid();
    updateInfo();
}

// --- AUTO-SPIN
function startSpinHold(e){
    if(spinHoldTimeout)clearTimeout(spinHoldTimeout);
    pointerIsDown=true;pointerDownTime=Date.now();
    spinTooltip.style.display="block";
    spinHoldTimeout=setTimeout(()=>{
        if(pointerIsDown&&!autoSpin){
            autoSpin=true;
            spinBtn.classList.add('auto');
            autoSpinIndicator.style.display="inline-block";
            doAutoSpin();
        }
    },1300);
}
function stopSpinHold(e){
    pointerIsDown=false;
    spinTooltip.style.display="none";
    if(spinHoldTimeout){clearTimeout(spinHoldTimeout);spinHoldTimeout=null;}
}
function doAutoSpin(){
    if (autoSpinTimer) clearTimeout(autoSpinTimer);
    if(!autoSpin || spinning) {spinBtn.classList.remove('auto');autoSpinIndicator.style.display="none";return;}
    if(coins<selectedBet){stopAutoSpin();return;}
    spin(true);
    autoSpinTimer=setTimeout(doAutoSpin,1500+Math.random()*800);
}
function stopAutoSpin(){
    autoSpin=false;
    spinBtn.classList.remove('auto');
    autoSpinIndicator.style.display="none";
    if(autoSpinTimer){clearTimeout(autoSpinTimer);autoSpinTimer=null;}
}

// --- –°—ä–±–∏—Ç–∏—è
spinBtn.addEventListener('mousedown', startSpinHold);
spinBtn.addEventListener('touchstart', startSpinHold);
spinBtn.addEventListener('mouseenter',()=>{spinTooltip.style.display="block";});
spinBtn.addEventListener('mouseleave',()=>{spinTooltip.style.display="none";});
spinBtn.addEventListener('mouseup', function (e) {
    stopSpinHold();
    let held = Date.now() - pointerDownTime;
    if (held < 1300 && !spinning) {
        if (autoSpin) { stopAutoSpin(); }
        else { spin(); }
    }
});
spinBtn.addEventListener('touchend', function (e) {
    stopSpinHold();
    let held = Date.now() - pointerDownTime;
    if (held < 1300 && !spinning) {
        if (autoSpin) { stopAutoSpin(); }
        else { spin(); }
    }
});
spinBtn.addEventListener('click', function (e) { winLabel.classList.remove('active'); });
restartBtn.addEventListener('click',restartGame);
betBtns.forEach(btn=>{
    btn.addEventListener('click',()=>{const val=Number(btn.innerText);setBet(val);});
});
document.addEventListener('keydown', function(e){
    if(document.activeElement && /input|textarea|button/i.test(document.activeElement.tagName)) return;
    if(e.code==="Space" && coins>0 && !spinning){spin();e.preventDefault();}
    if(e.key>='1' && e.key<='5' && coins>0){
        let idx = Number(e.key)-1;
        if(VALID_BETS[idx] && !betBtns[idx].disabled) setBet(VALID_BETS[idx]);
    }
});
window.onload = function(){
    grid=generateGrid();
    setBet(selectedBet);
    resizeCanvas();
    drawGrid();
    updateInfo();
    playMusic();
};
</script>
</body>
</html>
